<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Junk byte Injection en Android pre-kitkat</title>
    <meta name="description" content="Binary Exploitation, Evasion, Packers, Covert comms.">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://leonyya.github.io/2022/junk-byte-injection-android.html">
</head>

    <body>
            <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Leon</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>

            <div class="page content">
                <div class="wrapper">
                    <div class="post">

  <header class="post-header">
    <h1 class="post-title">Junk byte Injection en Android pre-kitkat</h1>
    <p class="post-meta">Apr 12, 2022</p>
  </header>

  <article class="post-content">
    <p>Junk byte injection:</p>

<p>En un <a href="https://web.archive.org/web/20170721234424/http://dexlabs.org/blog/bytecode-obfuscation">articulo</a> de un blog que data del 21 de Julio de 2012 el cual se pudo recuperar del Wayback machine, se aborda una tecnica que aprovecha una brecha de seguridad en el Dalvik VM (previo a Android 4.3 aproximadamente y versiones no lolipop ya que estas implementan ART el cual nunca fue susceptible al metodo).</p>

<p>El verificador de Dalvik es un proceso
https://android.googlesource.com/platform/dalvik/+/kitkat-release/vm/analysis/DexVerify.cpp#66 <em>linear walk</em></p>

<p>https://android.googlesource.com/platform/dalvik/+/kitkat-release/vm/analysis/DexVerify.cpp#705 <em>explicitly checks</em></p>

<p>https://android.googlesource.com/platform/dalvik/+/master/docs/verifier.html <em>verifier doc</em></p>

<p>https://android-review.googlesource.com/c/platform/dalvik/+/57985 <em>patch</em></p>

<p>CLASS_ISPREVERIFIED flag on the modified classes in the applicationâ€™s dex file, which prevents the dalvik verifier from verifying and rejecting the class. I submitted that change specifically to prevent this obfuscation technique</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">print_hi</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Hi, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
<span class="n">print_hi</span><span class="p">(</span><span class="s1">'Tom'</span><span class="p">)</span>
<span class="c1">#=&gt; prints 'Hi, Tom' to STDOUT.</span></code></pre></figure>

  </article>

</div>

                </div>
            </div>
            <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Leon</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Leon</li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Binary Exploitation, Evasion, Packers, Covert comms.</p>
      </div>
    </div>

  </div>

</footer>


    </body>
</html>
